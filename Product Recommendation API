# Python code using Flask for API implementation

from flask import Flask, request, jsonify
from pymongo import MongoClient
import random

app = Flask(__name__)
client = MongoClient("mongodb+srv://username:password@cluster.mongodb.net/dbname?retryWrites=true&w=majority")

db = client["fashion_app_database"]
user_creds = db["user_creds"]
catalog = db["catalog"]

@app.route('/product_recommendation', methods=['GET'])
def product_recommendation():
    username = request.args.get('username')

    # Check if the user exists
    user = user_creds.find_one({"username": username})
    if not user:
        return jsonify({"message": "User not found"}), 404

    preferred_category = user.get("preferred_category")
    if not preferred_category:
        # Return random 10 products if preferred category is not available
        result = random.sample(list(catalog.find()), 10)
    else:
        # Implement logic to fetch top 10 products based on preferred category and rank
        result = catalog.find({"product_category": preferred_category}).sort("rank").limit(10)

    response = [{"product_id": item["product_id"],
                 "product_category": item["product_category"],
                 "Rank": item["Rank"],
                 "brand_name": item["brand_name"],
                 "product_description": item["product_description"],
                 "price": item["price"],
                 "image_link": item["image_link"]} for item in result]

    return jsonify(response)

if __name__ == '__main__':
    app.run(debug=True)
